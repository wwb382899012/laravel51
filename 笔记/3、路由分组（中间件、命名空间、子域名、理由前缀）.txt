
https://laravelacademy.org/post/417.html


2、路由分组
路由分组就是将一组拥有相同属性（中间件、命名空间、子域名、路由前缀等）的路由使用Route门面的group方法聚合起来。

2.1 中间件
首先我们在应用根目录下运行如下Artisan命令生成一个测试用的中间件AgeMiddleware：

php artisan make:middleware AgeMiddleware
这样会在/app/Http/Middleware目录下生成一个AgeMiddleware.php文件，打开该文件编辑AgeMiddleware类的handle方法如下：

public function handle($request, Closure $next)
{
    if($request->input('age')<18)
        return redirect()->route('refuse');
    return $next($request);
}
我们在中间件中定义这段业务逻辑的目的是年龄18岁以下的未成年人不能访问。

然后我们打开/app/Http/Kernal.php文件，新增TestMiddleware到Kernel的$routeMiddleware属性：

protected $routeMiddleware = [
    'auth' => \App\Http\Middleware\Authenticate::class,
    'auth.basic' => \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
    'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
    'age' => \App\Http\Middleware\AgeMiddleware::class,
];
接下来我们在routes.php中定义路由如下：

Route::group(['middleware'=>'age'],function(){
    Route::get('/test',function(){
        //使用Age中间件
    });

});
Route::get('/test/refuse',['as'=>'refuse',function(){
    return "未成年人禁止入内！";
}]);
这样当我们在浏览器中访问http://laravel.app:8000/test?age=15时就会跳转到http://laravel.app:8000/test/refuse，并显示：

未成年人禁止入内！
2.2 命名空间
默认情况下，routes.php中的定义的控制器位于App\Http\Controllers命名空间下，所以如果要指定命名空间，只需指定App\Http\Controllers之后的部分即可：

Route::group(['namespace' => 'LaravelAcademy'], function(){
    // 控制器在 "App\Http\Controllers\LaravelAcademy" 命名空间下

    Route::group(['namespace' => 'DOCS'], function()
    {
        // 控制器在 "App\Http\Controllers\LaravelAcademy\DOCS" 命名空间下
    });
});
2.3 子域名
子域名可以通过domain关键字来设置：

Route::group(['domain'=>'{service}.laravel.app'],function(){
    Route::get('/write/laravelacademy',function($service){
        return "Write FROM {$service}.laravel.app";
    });
    Route::get('/update/laravelacademy',function($service){
        return "Update FROM {$service}.laravel.app";
    });
});
这样我们在浏览器中访问http://write.laravel.app:8000/write/laravelacademy，则输出

Write FROM write.laravel.app
访问http://update.laravel.app:8000/write/laravelacademy时，则输出：

Write FROM update.laravel.app
注意：要想让子域名解析生效，需要在hosts中绑定IP地址

2.4 路由前缀
如果路由群组中的所有路由包含统一前缀，则我们可以通过在group方法中设置prefix属性来指定该前缀：

Route::group(['prefix'=>'laravelacademy'],function(){
    Route::get('write',function(){
        return "Write LaravelAcademy";
    });
    Route::get('update',function(){
        return "Update LaravelAcademy";
    });
});
这样我们就可以通过http://laravel.app:8000/laravelacademy/write或者http://laravel.app:8000/laravelacademy/update来访问对应的操作。

我们甚至还可以在路由前缀中指定参数：

Route::group(['prefix'=>'laravelacademy/{version}'],function(){
    Route::get('write',function($version){
        return "Write LaravelAcademy {$version}";
    });
    Route::get('update',function($version){
        return "Update LaravelAcademy {$version}";
    });
});
这样我们在浏览器中访问http://laravel.app:8000/laravelacademy/5.1/write，则对应会输出：

Write LaravelAcademy 5.1